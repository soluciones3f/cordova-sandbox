<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link href="assets/ratchet/css/ratchet.css" rel="stylesheet">
    <link href="assets/css/styles.css" rel="stylesheet">
    <link href="assets/css/pageslider.css" rel="stylesheet">
</head>
<body>
    <button id="descargar">Descargar</button>
    <div><h4>Resultado</h4><p id="resultado"></p></div>
<script src="cordova.js"></script>
<script src="lib/jquery.js"></script>
<script type="text/javascript">
    //
    document.addEventListener('deviceready', function () {
      window.plugins.webintent.getExtra(webintent.EXTRA_STREAM,
        function (url)
        {
            uploadFile(url)

        }, function(error)
        {
            console.log('getExtra: EXTRA_TEXT failed');
            console.log(error)
        });
    });

    function win (r) {
        $("#resultado").append("Code = " + r.responseCode + "<br />");
        $("#resultado").append("Response = " + r.response + "<br />");
        $("#resultado").append("Sent = " + r.bytesSent);
    }

    function fail(error) {
        $("#resultado").html("")
        $("#resultado").append("An error has occurred: Code = " + error.code + "<br />");
        $("#resultado").append("upload error source " + error.source + "<br />");
        $("#resultado").append("upload error target " + error.target);
    }

    function uploadFile (fileURL) {
        var options = new FileUploadOptions();
        options.fileKey = "file";        
        options.fileName = fileURL.substr(fileURL.lastIndexOf('/') + 1);
        options.mimeType = "application/pdf";

        var params = {};
        params.note = "test";

        options.params = params;

        var ft = new FileTransfer();
        ft.upload(fileURL, encodeURI("http://cgi-lib.berkeley.edu/ex/fup.cgi"), win, fail, options);
    }
    

    function downloadFile(){
        var title = "file.pdf"
        var uri = encodeURI("http://www.me.gov.ar/doc_pdf/ley_de_educ_nac.pdf");
        window.requestFileSystem(LocalFileSystem.TEMPORARY, 0,
            function (fileSystem) {
                var fileTransfer = new FileTransfer();
                var filename = fileSystem.root.toURL() + title;
                fileTransfer.download(uri, filename,
                    function(entry) { // download success
                        $("#resultado").html("download complete: " + entry.toURL());
                        var windowTarget = device.platform.toLowerCase() === "ios" ? "_blank" : "_system";
                        // 'location=no,closebuttoncaption=Close,enableViewportScale=yes');
                        window.open(entry.toURL(), windowTarget, "location=no,toolbarposition=top,hidden=no,presentationstyle=pagesheet") ;

                    },
                    function(error) {
                        $("#resultado").append("download error source " + error.source + "<br />");
                        $("#resultado").append("download error target " + error.target + "<br />");
                        $("#resultado").append("upload error code" + error.code);
                    } 
                );
            },
            function(error) {alert(error)} // irrelevant request fileSystem error
        );

    }

    $(document).ready(function(){
        $("#descargar").click(function(e){
            e.preventDefault()
            downloadFile()
        })
    })
</script>
</body>